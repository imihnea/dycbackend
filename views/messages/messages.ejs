<% include ../partials/header %>
<link rel="stylesheet" type="text/css" media="screen" href="/dist/css/dashboard.css" />
<div class="columns" style="color: orange;">
    <% include ../partials/sidebar %>
    <div class="column dashboard-right">
        <% if (chats.docs.length === 0) { %>
            <p class="title">You do not have any open chats at this time.</p>
            <p class="subtitle">Chats get deleted after a month of no activity.</p>
        <% } else { %>
            <div style="display: flex; justify-content: center; margin-bottom: 2vh;">
                <p class="subtitle" style="padding-top: 0.3vh;">Pages:</p> 
                <% include ../partials/paginateChats %>
            </div>
        <% } %>
        <div class="columns" style="justify-content: space-evenly; flex-wrap: wrap;">
            

            <% chats.docs.forEach((chat) => { %>
                <div class="columns messageItem">
                    <a href="/messages/<%= chat._id %>">
                        <span style="position:absolute; 
                                        width:100%;
                                        height:100%;
                                        top:0;
                                        left: 0;
                                        z-index: 1;">
                        </span>
                    </a>
                    <div class="column is-half">
                        <img src="<% if (chat.user1.id.toString() !== user._id.toString()) { %> 
                            <%= chat.user1.avatarUrl %>
                        <% } else { %>
                            <%= chat.user2.avatarUrl %>
                        <% } %>"  style="width: 100%; height: 100px; display: block;" class="open-img">
                    </div>
                    <div class="column prod_info ">
                        <p class="title is-5" style="font-size: 0.9rem !important;"><% if (chat.user1.id.toString() !== user._id.toString()) { %> 
                            <%= chat.user1.fullname %>
                        <% } else { %>
                            <%= chat.user2.fullname %>
                        <% } %></p>
                        <p class="title is-5" style="font-size: 0.9rem !important;">Deal: <%= chat.product.name %></p>
                        <p class="subtitle" style="font-size: 0.9rem !important;">Last message: <br>
                            <%=((  chat.messages[chat.messageCount - 1].createdAt.getMonth() + 1) < 10) ? '0' + ( chat.messages[chat.messageCount - 1].createdAt.getMonth() + 1) : ( chat.messages[chat.messageCount - 1].createdAt.getMonth() + 1) %>
                            /<%= (( chat.messages[chat.messageCount - 1].createdAt.getDate()) < 10) ? '0' + ( chat.messages[chat.messageCount - 1].createdAt.getDate()) : ( chat.messages[chat.messageCount - 1].createdAt.getDate()) %> -
                            <%= (( chat.messages[chat.messageCount - 1].createdAt.getHours()) < 10) ? '0' + ( chat.messages[chat.messageCount - 1].createdAt.getHours()) : ( chat.messages[chat.messageCount - 1].createdAt.getHours()) %>:
                            <%= (( chat.messages[chat.messageCount - 1].createdAt.getMinutes()) < 10) ? '0' + ( chat.messages[chat.messageCount - 1].createdAt.getMinutes()) : ( chat.messages[chat.messageCount - 1].createdAt.getMinutes()) %></p>
                    </div>
                </div>
            <% }); %>  

        </div>
        <% if (chats.docs.length !== 0 ) { %>
            <div style="display: flex; justify-content: center; margin-top: 4vh;">
                <p class="subtitle" style="padding-top: 0.3vh;">Pages:</p> 
                <% include ../partials/paginateChats %>
            </div>
        <% } %>
    </div>
</div>

<% include ../partials/footer %>
<script src="../../dist/js/messages.js"></script>
<script src='../../dist/js/dashboard_products.js'></script>