<% include ../partials/header %>
<script src="../../dist/js/maincateg.js"></script>
<script src="../../dist/js/products.js"></script>       
<link rel="stylesheet" href="../../dist/css/categories.css">
<link rel="stylesheet" href="../../dist/css/products.css">
<link rel="stylesheet" href="../../dist/css/product_view.css">
<link rel="stylesheet" href="/../dist/css/index.css"> 
<link rel="stylesheet" href="/../dist/css/starability-basic.min.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<script src="../../dist/js/product_view.js"></script>
<div class="hero-body">
    <div class="container ">
        <div class="column">
            <h1 class="title"><strong><%= product.name %></strong></h2>
            <% for(let i = 0; i < 5; i++) { %>
                <% if(i < floorRating) { %>
                <!-- display a full star -->
                <i class="fas fa-star"></i>
                <% } else if((product.avgRating - i) > 0 && (product.avgRating - i) < 1) { %>
                <!-- display a half star -->
                <i class="fas fa-star-half-alt"></i>
                <% } else { %>
                <!-- display an empty star -->
                <i class="far fa-star"></i>
                <% } %>
            <% } %>
            <%= `${product.avgRating} star${product.avgRating === 1 ? '' : 's'}` %>
        </div>
        <hr>
        <div class="columns" style="height: 39vh;">
            <div class="column ">
                <div class="thumbnails">
                    <div class="level">
                        <input type="radio" name="slide_switch" id="id1" checked="checked"/>
                        <label for="id1">
                            <img class="thumbnail" src="<%= product.images[0].url %>"/>
                        </label>
                    </div>
                    <% if (product.images[1]) { %>
                    <div class="level">
                        <input type="radio" name="slide_switch" id="id2"/>
                        <label for="id2">
                            <img class="thumbnail" src="<%= product.images[1].url %>"/>
                        </label>
                    </div>
                    <% } %>
                    <% if (product.images[2]) { %>
                    <div class="level">
                        <input type="radio" name="slide_switch" id="id3"/>
                        <label for="id3">
                            <img class="thumbnail" src="<%= product.images[2].url %>"/>
                        </label>
                    </div>
                    <% } %>
                    <% if (product.images[3]) { %>
                    <div class="level">
                        <input type="radio" name="slide_switch" id="id4"/>
                        <label for="id4">
                            <img class="thumbnail" src="<%= product.images[3].url %>"/>
                        </label>
                    </div>
                    <% } %>
                    <% if (product.images[4]) { %>
                    <div class="level">
                        <input type="radio" name="slide_switch" id="id5"/>
                        <label for="id5">
                            <img class="thumbnail" src="<%= product.images[4].url %>"/>
                        </label>
                    </div> 
                    <% } %>                
                </div>
            </div>
            <div class="column is-three-fifths">
                <div class="slider">
                    <img class="mainImg " src="<%= product.images[0].url %>"/>
                    <% if (product.images[1]) { %>
                    <img class="mainImg hiddenImg" src="<%= product.images[1].url %>"/>
                    <% } %>
                    <% if (product.images[2]) { %>
                    <img class="mainImg hiddenImg" src="<%= product.images[2].url %>"/>
                    <% } %>
                    <% if (product.images[3]) { %>
                    <img class="mainImg hiddenImg" src="<%= product.images[3].url %>"/>
                    <% } %>
                    <% if (product.images[4]) { %>
                    <img class="mainImg hiddenImg" src="<%= product.images[4].url %>"/>
                    <% } %>
                </div>
            </div>
            <div class="column is-one-quarter">
                <p class="productUserText">Sold by: <a class="productUserLink" href="#">AAAAAAAA  <span style="color: green !important;">x/5 <i class="fas fa-star"></i></span></a></p>
                <% if ((product.price[0] != 0) && (product.accepted[0])) { %>
                    <div class="prices">
                        <span class="price_img"><img src="../../dist/img/bitcoin.png" alt="Bitcoin"></span>
                        <p class="price_text"> <%= product.price[0] %></p>
                    </div>
                <% } 
                    if ((product.price[1] != 0) && (product.accepted[1])) {
                %>
                    <div class="prices">
                        <span class="price_img"><img src="../../dist/img/bitcoincash.png" alt="BitcoinCash"></span>
                        <p class="price_text"> <%= product.price[1] %></p>
                    </div>
                <% } 
                    if ((product.price[2] != 0) && (product.accepted[2])) {
                %>
                    <div class="prices">
                        <span class="price_img"><img src="../../dist/img/ethereum.png" alt="Ethereum"></span>
                        <p class="price_text"> <%= product.price[2] %></p>
                    </div>
                <% } 
                    if ((product.price[3] != 0) && (product.accepted[3])) {
                %>
                    <div class="prices">
                        <span class="price_img"><img src="../../dist/img/litecoin.png" alt="Litecoin"></span>
                        <p class="price_text"> <%= product.price[3] %></p>
                    </div>
                <% } 
                    if ((product.price[4] != 0) && (product.accepted[4])) {
                %>
                    <div class="prices">
                        <span class="price_img"><img src="../../dist/img/dash.png" alt="DASH"></span> 
                        <p class="price_text"> <%= product.price[4] %></p>
                    </div>
                <% } %>
                <p style="color: orange !important;"><sub>Transportation cost: TBD</sub></p>
                <br>
               
                <form action="/products/<%= product.id %>/buy" method="POST">
                    
                    <% 
                        product.accepted.forEach((key, i) => {
                            if ((key === 'true') && (i === 0)){ %>
                                <label class="img-check ">
                                    <img src="../../dist/img/bitcoin.png" alt="Bitcoin" class="cccy gray" id="btcimg">
                                    <input id="btc-check" type="radio" name="currency" class="curr_checkbox" value="BTC" required>
                                </label>
                            <% }
                            if ((key === 'true') && (i === 1)){ %>
                                <label class="img-check ">
                                    <img src="../../dist/img/bitcoincash.png" alt="BitcoinCash" class="cccy gray" id="bchimg">
                                    <input id="bch-check" type="radio" name="currency"  class="curr_checkbox" value="BCH">
                                </label>
                            <% }
                            if ((key === 'true') && (i === 2)){ %>
                                <label class="img-check ">
                                    <img src="../../dist/img/ethereum.png" alt="ethereum" class="cccy gray" id="ethimg">
                                    <input id="eth-check" type="radio" name="currency"  class="curr_checkbox" value="ETH">
                                </label>
                            <% }
                            if ((key === 'true') && (i === 3)){ %>
                                <label class="img-check ">
                                    <img src="../../dist/img/litecoin.png" alt="Litecoin" class="cccy gray" id="ltcimg">
                                    <input id="ltc-check" type="radio" name="currency"  class="curr_checkbox" value="LTC">
                                </label>
                            <% }
                            if ((key === 'true') && (i === 4)){ %>
                                <label class="img-check ">
                                    <img src="../../dist/img/dash.png" alt="DASH" class="cccy gray" id="dashimg">
                                    <input id="dash-check" type="radio" name="currency"  class="curr_checkbox" value="DASH">
                                </label>
                            <% }
                        });
                    %>
                    <div class="control smmargin">
                        <button class="button is-primary">Buy</button>
                    </div>
                </form>
                <div style="margin-top: 1vh;">
                    <form action="/messages/<%= product._id %>/createChat" method="POST">
                        <button class="productContactLink button is-primary">Contact</button>
                    </form>
                </div>
            </div>  
        </div>
        <hr>
        <div class="column">
            <p class="productSubTitleText">Description</p>
            <br>
            <p class="productDescriptionText" ><%= product.description %></p>
        </div> 
        <hr>
        <% if(currentUser){ %>
            <p class="productSubTitleText" >Create a Review</p>
            <form action="/products/<%= product.id %>/reviews" method="POST">
                <textarea class="textarea" name="review[body]" required></textarea>
                <fieldset class="starability-basic">
                <legend class="productDescriptionText">Rating:</legend>
                <input type="radio" id="rate0" class="input-no-rate" name="review[rating]" value="0" checked aria-label="No rating." />
                <input type="radio" id="rate1" name="review[rating]" value="1" />
                <label for="rate1" title="Terrible">1 star</label>
                <input type="radio" id="rate2" name="review[rating]" value="2" />
                <label for="rate2" title="Not good">2 stars</label>
                <input type="radio" id="rate3" name="review[rating]" value="3" />
                <label for="rate3" title="Average">3 stars</label>
                <input type="radio" id="rate4" name="review[rating]" value="4" />
                <label for="rate4" title="Very good">4 stars</label>
                <input type="radio" id="rate5" name="review[rating]" value="5" />
                <label for="rate5" title="Amazing">5 stars</label>
                </fieldset>
    
                <input class="button is-primary" type="submit">
                <hr>
            </form>
            <% } %>
            <div class="column">
                <p class="productSubTitleText">Reviews</p>
                <br>
                <!-- display all reviews -->
                <% product.reviews.forEach(function(review) { %>
                    <div>
                        <p class="productDescriptionText" >Author: <%= review.author.username %><br>
                        <p class="productDescriptionText" >Comment: <%= review.body %><br>
                        <p class="productDescriptionText" >Rating: <%= review.rating %> stars
                    </div>
                    <% if(currentUser){ %>
                        <% if(review.author.equals(currentUser._id)) { %>
                        <div>
                            <button class="button is-primary">Edit</button>
    
                            <form action="/products/<%= product.id %>/reviews/<%= review.id %>?_method=PUT" method="POST" class="edit-review-form">
                                <textarea name="review[body]" required><%= review.body %></textarea>
                                <fieldset class="starability-basic">
                                <legend>Rating:</legend>
                                <input type="radio" id="edit-rate0" class="input-no-rate" name="review[rating]" value="0" checked aria-label="No rating." />
                                <input type="radio" id="edit-rate1" name="review[rating]" value="1" />
                                <label for="edit-rate1" title="Terrible">1 star</label>
                                <input type="radio" id="edit-rate2" name="review[rating]" value="2" />
                                <label for="edit-rate2" title="Not good">2 stars</label>
                                <input type="radio" id="edit-rate3" name="review[rating]" value="3" />
                                <label for="edit-rate3" title="Average">3 stars</label>
                                <input type="radio" id="edit-rate4" name="review[rating]" value="4" />
                                <label for="edit-rate4" title="Very good">4 stars</label>
                                <input type="radio" id="edit-rate5" name="review[rating]" value="5" />
                                <label for="edit-rate5" title="Amazing">5 stars</label>
                                </fieldset>
    
                                <input class="button is-primary" type="submit" value="Update">
                            </form>
                            
                            <script>
                                $('#edit-rate<%= review.rating %>').prop('checked', true);
                            </script>
    
                            <form action="/products/<%= product.id %>/reviews/<%= review.id %>?_method=DELETE" method="POST">
                                <input class="button is-primary" type="submit" value="Delete">
                            </form>
                        </div>
                        <% } %>
                    <% } %>
                    <hr>
                <% }); %>
            </div>
        <p class="productSubTitleText">Similar products</p>
        <div class="column">    
            <!-- Add a few products from the same category -->
            <div class="columns" style="justify-content: center;">
                <div class="column card feat_card" style="max-width: 250px;">
                    <a href="">
                        <div class="card-image">
                            <figure class="image featimg">
                                <img src="../../dist/img/blanc.jpg" class="featimgs">
                            </figure>
                        </div>
                        <div class="card-content">
                            <div class="media">
                                <div class="media-content">
                                    <p class="title is-5">asdfadsfd fdafdsafa das fdsa dsa dsa da </p>
                                </div>
                            </div>
                            <div class="accepted_currencies">
                                <img src="../../dist/img/bitcoin.png" class="curr_img" alt="Bitcoin">
                                <img src="../../dist/img/bitcoincash.png" class="curr_img"  alt="Bitcoin Cash">
                                <img src="../../dist/img/ethereum.png" class="curr_img"  alt="Ethereum">
                                <img src="../../dist/img/litecoin.png" class="curr_img"  alt="Litecoin">
                                <img src="../../dist/img/dash.png" class="curr_img"  alt="DASH">
                            </div>
                             
                        </div> 
                    </a>                       
                </div>
                <div class="column card feat_card">
                    <a href="">
                        <div class="card-image">
                            <figure class="image featimg">
                                <img src="../../dist/img/blanc.jpg" class="featimgs">
                            </figure>
                        </div>
                        <div class="card-content">
                            <div class="media">
                                <div class="media-content">
                                    <p class="title is-5">asdfadsfd fdafdsafa das fdsa dsa dsa da </p>
                                </div>
                            </div>
                            <div class="accepted_currencies">
                                <img src="../../dist/img/bitcoin.png" class="curr_img" alt="Bitcoin">
                                <img src="../../dist/img/bitcoincash.png" class="curr_img"  alt="Bitcoin Cash">
                                <img src="../../dist/img/ethereum.png" class="curr_img"  alt="Ethereum">
                                <img src="../../dist/img/litecoin.png" class="curr_img"  alt="Litecoin">
                                <img src="../../dist/img/dash.png" class="curr_img"  alt="DASH">
                            </div>
                             
                        </div> 
                    </a>                       
                </div>
                <div class="column card feat_card">
                    <a href="">
                        <div class="card-image">
                            <figure class="image featimg">
                                <img src="../../dist/img/blanc.jpg" class="featimgs">
                            </figure>
                        </div>
                        <div class="card-content">
                            <div class="media">
                                <div class="media-content">
                                    <p class="title is-5">asdfadsfd fdafdsafa das fdsa dsa dsa da </p>
                                </div>
                            </div>
                            <div class="accepted_currencies">
                                <img src="../../dist/img/bitcoin.png" class="curr_img" alt="Bitcoin">
                                <img src="../../dist/img/bitcoincash.png" class="curr_img"  alt="Bitcoin Cash">
                                <img src="../../dist/img/ethereum.png" class="curr_img"  alt="Ethereum">
                                <img src="../../dist/img/litecoin.png" class="curr_img"  alt="Litecoin">
                                <img src="../../dist/img/dash.png" class="curr_img"  alt="DASH">
                            </div>
                             
                        </div> 
                    </a>                       
                </div>
                <div class="column card feat_card">
                    <a href="">
                        <div class="card-image">
                            <figure class="image featimg">
                                <img src="../../dist/img/blanc.jpg" class="featimgs">
                            </figure>
                        </div>
                        <div class="card-content">
                            <div class="media">
                                <div class="media-content">
                                    <p class="title is-5">asdfadsfd fdafdsafa das fdsa dsa dsa da </p>
                                </div>
                            </div>
                            <div class="accepted_currencies">
                                <img src="../../dist/img/bitcoin.png" class="curr_img" alt="Bitcoin">
                                <img src="../../dist/img/bitcoincash.png" class="curr_img"  alt="Bitcoin Cash">
                                <img src="../../dist/img/ethereum.png" class="curr_img"  alt="Ethereum">
                                <img src="../../dist/img/litecoin.png" class="curr_img"  alt="Litecoin">
                                <img src="../../dist/img/dash.png" class="curr_img"  alt="DASH">
                            </div>
                             
                        </div> 
                    </a>                       
                </div>
            </div>
        </div>
    </div>    
</div> 

<% include ../partials/footer %>