<% include partials/header %>

<link rel="stylesheet" href="/dist/css/slideshow.css">

<div id="slider">
    <div class="slides">
        <div class="slider">
        <div class="legend"></div>
        <div class="image">
            <form action="/secondCategSearch" method="POST">
                <input type="text" name="searchName" value="" hidden>
                <input type="text" name="searchCateg" value="Collectibles & Art" hidden>
                <input type="text" name="category" value="Collectibles" hidden>
                <button aria-label="Slider Button 1" class="sliderBtn"><div class="slider-image"><img src="/dist/img/slider1.png" alt="Slider image 1" style="width: 100vw;"></div></button>
            </form>
        </div>
        </div>
        <div class="slider">
            <div class="legend"></div>
            <div class="image">
                <form action="/secondCategSearch" method="POST">
                    <input type="text" name="searchName" value="" hidden>
                    <input type="text" name="searchCateg" value="Leisure Time" hidden>
                    <input type="text" name="category" value="Music" hidden>
                    <button aria-label="Slider Button 2" class="sliderBtn"><div class="slider-image"><img src="/dist/img/slider2.png" alt="Slider image 2"  style="width: 100vw;"></div></button>
                </form>
            </div>
        </div>
        <div class="slider">
            <div class="legend"></div>
            <div class="image">
                <form action="/secondCategSearch" method="POST">
                    <input type="text" name="searchName" value="" hidden>
                    <input type="text" name="searchCateg" value="Sports & Outdoors" hidden>
                    <input type="text" name="category" value="Sports & Fitness" hidden>
                    <button aria-label="Slider Button 3" class="sliderBtn"><div class="slider-image"><img src="/dist/img/slider3.png" alt="Slider image 3"  style="width: 100vw;"></div></button>
                </form>
            </div>
        </div>
    </div>
    <div class="switch">
        <ul>
            <li>
            <div class="on"></div>
            </li>
            <li></li>
            <li></li>
        </ul>
        </div>
</div>

<div class="container is-fluid">
    <% if(errors){ %>
        <div class="notification is-danger" role="alert"> 
        <% errors.forEach(function( err){ %>
            <%= err.msg %><br>
        <% }) %>
        </div>
    <% } %>
</div>

<div class="hero-body hero-content">

        <% if (onlyFeatured) { %>
            <div class="column">
                <p class="title is-2">Featured Products</p>
            </div>
            <br>
        <% } else { %>
            <div class="column">
                <p class="title is-2">Products currently for sale</p>
            </div>
            <br>
        <% } %>

        <% 
            const k = products.length;
            let j = 0;
        %>
        <div class="columns products indexProducts"> 
                <% if (products.length != 0) { %>
                    <% 
                        let a = products;
                        let b = [];
                        b = a.splice(0, 7);
                    %>
                    <div class="columns indexRow">
                        <% b.forEach(product => { %>
                            <div class="column card feat_card frame activeDealProduct <% if ((product.feat_2.status == true) && (!onlyFeatured)) { %>featured<% } %>">
                                <a href="/products/<%= product._id %>/view">
                                    <div class="card-image">
                                        <figure class="image featimg is-square" style="width: auto;">
                                            <img src="<%= product.images[0].url %>" class="featimgs" alt="<%= product.name %>">
                                        </figure>
                                    </div>
                                    <div class="card-content">
                                        <div class="media">
                                            <div class="media-content">
                                                <p class="title productName" style="overflow: hidden;"><%= product.name %></p>
                                            </div>
                                        </div>
                                        <p class="curr_text"><b><%= product.btcPrice %></b> BTC</p>
                                    </div> 
                                </a>      
                            </div>
                        <% j += 1; }); %> 
                    </div>
                    <%  while ((j < 20) && (a.length > 0)) { b = a.splice(0, 7); %>
                        <div class="columns indexRow">
                            <% b.forEach(product => { %>
                                <div class="column card feat_card frame activeDealProduct <% if ((product.feat_2.status == true) && (!onlyFeatured)) { %>featured<% } %>">
                                    <a href="/products/<%= product._id %>/view">
                                        <div class="card-image">
                                            <figure class="image featimg is-square" style="width: auto;">
                                                <img src="<%= product.images[0].url %>" class="featimgs" alt="<%= product.name %>">
                                            </figure>
                                        </div>
                                        <div class="card-content">
                                            <div class="media">
                                                <div class="media-content">
                                                    <p class="title productName" style="overflow: hidden;"><%= product.name %> </p>
                                                </div>
                                            </div>
                                            <p class="curr_text"><b><%= product.btcPrice %></b> BTC</p>
                                        </div>
                                    </a>      
                                </div>
                                <% j += 1; %>
                            <% }); %>
                            <% if (b.length < 7) { %>
                                <% for (let v = b.length; v < 7; v+= 1) { %>
                                    <div class="column"></div>
                                <% } %>
                            <% } %>
                        </div>
                    <% } %>
                    <% while (a.length > 0) { b = a.splice(0, 7); %>
                        <div class="columns indexRow hiddenRow">
                            <% b.forEach(product => { %>
                                <div class="column card feat_card frame activeDealProduct lazyLoad <% if ((product.feat_2.status == true) && (!onlyFeatured)) { %>featured<% } %>" >
                                    <a href="/products/<%= product._id %>/view">
                                        <div class="card-image">
                                            <figure class="image featimg is-square" style="width: auto;">
                                                <img data-src="<%= product.images[0].url %>" class="featimgs lazyLoadImg" alt="<%= product.name %>">
                                            </figure>
                                        </div>
                                        <div class="card-content">
                                            <div class="media">
                                                <div class="media-content">
                                                    <p class="title productName" style="overflow: hidden;"><%= product.name %> </p>
                                                </div>
                                            </div>
                                            <p class="curr_text"><b><%= product.btcPrice %></b> BTC</p>
                                        </div> 
                                    </a>      
                                </div>
                            <% }); %>
                            <% if (b.length < 7) { %>
                                <% for (let v = b.length; v < 7; v+= 1) { %>
                                    <div class="column"></div>
                                <% } %>
                            <% } %>
                        </div>
                    <% } %>
                <% } %>
            </div>
            <% if (k > 20) { %>
                <div class="buttons column">
                    <button class="button is-primary showMore is-large">Show More</button>
                    <button class="button is-primary showLess is-large hidden">Show Less</button>
                </div>
            <% } %>

</div>

<script src="/dist/js/index.js"></script>
<% include partials/footer %>
